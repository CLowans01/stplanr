<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Aggregate OD data between polygon geometries — od_aggregate • stplanr</title>

<!-- jquery -->
<script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script>

<!-- sticky kit -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>



<meta property="og:title" content="Aggregate OD data between polygon geometries — od_aggregate" />

<meta property="og:description" content="Aggregate OD data between polygon geometries" />
<meta name="twitter:card" content="summary" />



<!-- mathjax -->
<script src='https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML'></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->


  </head>

  <body>
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">stplanr</a>
        <span class="label label-default" data-toggle="tooltip" data-placement="bottom" title="Released package">0.2.5</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/introducing-stplanr.html">Introducing stplanr</a>
    </li>
    <li>
      <a href="../articles/stplanr-paper.html">stplanr: A Package for Transport Planning</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/ropensci/stplanr">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      
      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Aggregate OD data between polygon geometries</h1>
    <small class="dont-index">Source: <a href='https://github.com/ropensci/stplanr/blob/master/R/aggregate_funs.R'><code>R/aggregate_funs.R</code></a></small>
    <div class="hidden name"><code>od_aggregate.Rd</code></div>
    </div>

    <div class="ref-description">
    
    <p>Aggregate OD data between polygon geometries</p>
    
    </div>

    <pre class="usage"><span class='fu'>od_aggregate</span>(<span class='no'>flow</span>, <span class='no'>zones</span>, <span class='no'>aggzones</span>, <span class='kw'>aggzone_points</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>cols</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>, <span class='kw'>aggcols</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>, <span class='kw'>FUN</span> <span class='kw'>=</span> <span class='no'>sum</span>,
  <span class='kw'>prop_by_area</span> <span class='kw'>=</span> <span class='fu'>ifelse</span>(<span class='fu'>identical</span>(<span class='no'>FUN</span>, <span class='no'>mean</span>) <span class='kw'>==</span> <span class='fl'>FALSE</span>, <span class='fl'>TRUE</span>, <span class='fl'>FALSE</span>),
  <span class='kw'>digits</span> <span class='kw'>=</span> <span class='fu'>getOption</span>(<span class='st'>"digits"</span>))</pre>
    
    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>flow</th>
      <td><p>A data frame representing the flow between two points
or zones. The first two columns of this data frame should correspond
to the first column of the data in the zones. Thus in <code><a href='cents.html'>cents()</a></code>,
the first column is geo_code. This corresponds to the first two columns
of <code><a href='flow.html'>flow()</a></code>.</p></td>
    </tr>
    <tr>
      <th>zones</th>
      <td><p>A SpatialPolygonsDataFrame or SpatialPointsDataFrame
representing the original centroids or boundaries of the travel flow data.
Note that in the case of a SpatialPointsDataFrame, the entirety of the flow
will be allocated to the polygon in which the point is located rather than
being distributed by area.</p></td>
    </tr>
    <tr>
      <th>aggzones</th>
      <td><p>A SpatialPolygonsDataFrame containing the new
boundaries to aggregate to.</p></td>
    </tr>
    <tr>
      <th>aggzone_points</th>
      <td><p>Points representing origins of OD flows
(typically population-weighted centroids)</p></td>
    </tr>
    <tr>
      <th>cols</th>
      <td><p>A character vector containing the names of columns on which to
apply FUN. By default, all numeric columns are aggregated.</p></td>
    </tr>
    <tr>
      <th>aggcols</th>
      <td><p>A character vector containing the names of columns in
aggzones to retain in the aggregated data.frame. By default,
only the first column is retained. These columns are renamed with a prefix
of "o_" and "d_".</p></td>
    </tr>
    <tr>
      <th>FUN</th>
      <td><p>Function to use on aggregation. Default is sum.</p></td>
    </tr>
    <tr>
      <th>prop_by_area</th>
      <td><p>Boolean value indicating if the values should be
proportionally adjusted based on area. Default is TRUE unless FUN = mean.</p></td>
    </tr>
    <tr>
      <th>digits</th>
      <td><p>The number of digits to use when proportionally adjusting
values based on area. Default is the value of getOption("digits").</p></td>
    </tr>
    </table>
    
    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>data.frame containing the aggregated od flows.</p>
    
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    
    <p>Origin-destination ('OD') flow data is often provided
in the form of 1 line per flow with zone codes of origin and destination
centroids. This function aggregates OD flows between polygon geometries
allocating the original flows to larger zones based on area.</p>
    

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='no'>zones</span>$<span class='no'>quadrant</span> <span class='kw'>&lt;-</span> <span class='fu'>c</span>(<span class='fl'>1</span>, <span class='fl'>2</span>, <span class='fl'>1</span>, <span class='fl'>4</span>, <span class='fl'>5</span>, <span class='fl'>6</span>, <span class='fl'>7</span>, <span class='fl'>1</span>)
<span class='no'>aggzones</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>rgeos</span><span class='kw ns'>::</span><span class='fu'><a href='http://www.rdocumentation.org/packages/rgeos/topics/topo-bin-gUnion'>gUnaryUnion</a></span>(<span class='no'>zones</span>, <span class='kw'>id</span> <span class='kw'>=</span> <span class='no'>zones</span>@<span class='kw'>data</span>$<span class='no'>quadrant</span>)
<span class='no'>aggzones</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>sp</span><span class='kw ns'>::</span><span class='fu'><a href='http://www.rdocumentation.org/packages/sp/topics/SpatialPolygons'>SpatialPolygonsDataFrame</a></span>(<span class='no'>aggzones</span>, <span class='fu'>data.frame</span>(<span class='kw'>region</span> <span class='kw'>=</span> <span class='fu'>c</span>(<span class='fl'>1</span>:<span class='fl'>6</span>)), <span class='kw'>match.ID</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>)
<span class='kw pkg'>sp</span><span class='kw ns'>::</span><span class='fu'><a href='http://www.rdocumentation.org/packages/sp/topics/is.projected'>proj4string</a></span>(<span class='no'>aggzones</span>) <span class='kw'>&lt;-</span> <span class='kw pkg'>sp</span><span class='kw ns'>::</span><span class='fu'><a href='http://www.rdocumentation.org/packages/sp/topics/is.projected'>proj4string</a></span>(<span class='no'>zones</span>)
<span class='no'>aggzones_sf</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>sf</span><span class='kw ns'>::</span><span class='fu'><a href='http://www.rdocumentation.org/packages/sf/topics/st_as_sf'>st_as_sf</a></span>(<span class='no'>aggzones</span>)
<span class='no'>aggzones_sf</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>sf</span><span class='kw ns'>::</span><span class='fu'><a href='http://www.rdocumentation.org/packages/sf/topics/st_crs'>st_set_crs</a></span>(<span class='no'>aggzones_sf</span>, <span class='kw pkg'>sf</span><span class='kw ns'>::</span><span class='fu'><a href='http://www.rdocumentation.org/packages/sf/topics/st_crs'>st_crs</a></span>(<span class='no'>zones_sf</span>))
<span class='no'>od_agg</span> <span class='kw'>&lt;-</span> <span class='fu'>od_aggregate</span>(<span class='no'>flow</span>, <span class='no'>zones_sf</span>, <span class='no'>aggzones_sf</span>)</div><div class='output co'>#&gt; <span class='warning'>Warning: st_centroid assumes attributes are constant over geometries of x</span></div><div class='output co'>#&gt; <span class='warning'>Warning: st_centroid does not give correct centroids for longitude/latitude data</span></div><div class='output co'>#&gt; <span class='warning'>Warning: st_centroid assumes attributes are constant over geometries of x</span></div><div class='output co'>#&gt; <span class='warning'>Warning: st_centroid does not give correct centroids for longitude/latitude data</span></div><div class='output co'>#&gt; <span class='message'>although coordinates are longitude/latitude, st_intersects assumes that they are planar</span></div><div class='output co'>#&gt; <span class='message'>Joining, by = "Area.of.residence"</span></div><div class='output co'>#&gt; <span class='warning'>Warning: Column `Area.of.residence` joining character vector and factor, coercing into character vector</span></div><div class='output co'>#&gt; <span class='message'>Joining, by = "Area.of.workplace"</span></div><div class='output co'>#&gt; <span class='warning'>Warning: Column `Area.of.workplace` joining character vector and factor, coercing into character vector</span></div><div class='input'><span class='fu'>colSums</span>(<span class='no'>od_agg</span>[<span class='fl'>3</span>:<span class='fl'>9</span>]) <span class='kw'>==</span> <span class='fu'>colSums</span>(<span class='no'>flow</span>[<span class='fl'>3</span>:<span class='fl'>9</span>])</div><div class='output co'>#&gt;                                  All          Work.mainly.at.or.from.home 
#&gt;                                 TRUE                                 TRUE 
#&gt; Underground..metro..light.rail..tram                                Train 
#&gt;                                 TRUE                                 TRUE 
#&gt;                Bus..minibus.or.coach                                 Taxi 
#&gt;                                 TRUE                                 TRUE 
#&gt;         Motorcycle..scooter.or.moped 
#&gt;                                 TRUE </div><div class='input'><span class='no'>od_sf_agg</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='od2line.html'>od2line</a></span>(<span class='no'>od_agg</span>, <span class='no'>aggzones_sf</span>)</div><div class='output co'>#&gt; <span class='warning'>Warning: st_centroid assumes attributes are constant over geometries of x</span></div><div class='output co'>#&gt; <span class='warning'>Warning: st_centroid does not give correct centroids for longitude/latitude data</span></div><div class='input'><span class='fu'>plot</span>(<span class='no'>flowlines</span>, <span class='kw'>lwd</span> <span class='kw'>=</span> <span class='no'>flowlines</span>$<span class='no'>Bicycle</span>)</div><div class='input'><span class='fu'>plot</span>(<span class='no'>od_sf_agg</span>$<span class='no'>geometry</span>, <span class='kw'>lwd</span> <span class='kw'>=</span> <span class='no'>od_sf_agg</span>$<span class='no'>Bicycle</span>, <span class='kw'>add</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>, <span class='kw'>col</span> <span class='kw'>=</span> <span class='st'>"red"</span>)</div><div class='img'><img src='od_aggregate-1.png' alt='' width='700' height='433' /></div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2>Contents</h2>
    <ul class="nav nav-pills nav-stacked">
      <li><a href="#arguments">Arguments</a></li>
      
      <li><a href="#value">Value</a></li>

      <li><a href="#details">Details</a></li>
      
      <li><a href="#examples">Examples</a></li>
    </ul>

  </div>
</div>

      <footer>
      <div class="copyright">
  <p>Developed by Robin Lovelace, Richard Ellison.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
   </div>

  

  </body>
</html>

